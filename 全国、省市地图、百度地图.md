```
<template>
  <!-- 主体内容区 -->
  <div class="map-container flex">
    <div class="back-home" v-show="baiduMapShow" @click="mapHide">返回</div>
    <div class="app-left">
      <div class="top-info flex">
        <div class="reports-container">
          <div class="reports-header flex">
            <div
              class="report-type"
              :class="{ active: activeType === 1 }"
              @click="getReportList(1)"
            >
              快报
            </div>
            <div
              class="report-type"
              :class="{ active: activeType === 2 }"
              @click="getReportList(2)"
            >
              专报
            </div>
          </div>
          <div class="reports-list">
            <div
              class="report-item flex"
              v-for="(item, index) in reportList"
              :key="index"
              @click="goReportDetail(item.id)"
            >
              <div class="report-left">
                {{ item.place }}{{ item.level }}级地震
              </div>
              <div class="report-right">{{ item.startDate }}</div>
            </div>
          </div>
        </div>
        <div class="maps-page">
          <div class="maps-header flex between">
            <div>专题图件</div>
            <!-- <div class="more">更多</div> -->
          </div>
          <div class="maps-list flex between">
            <div
              class="maps-item"
              :class="{ active: activeMap === index }"
              v-for="(item, index) in mapslist"
              :key="index"
              @click="mapShow(index)"
            >
              {{ item }}
            </div>
          </div>
        </div>
      </div>
      <div class="disaster-container">
        <div class="header center">受灾人口（实时）</div>
        <div class="people-disaster flex">
          <div
            class="people"
            v-for="(item, index) in disasterPeople"
            :key="index"
          >
            <div class="count">{{ item.count }}</div>
            <div class="name">{{ item.name }}</div>
          </div>
        </div>
      </div>
      <div class="charts-num">
        <div ref="dataChart" class="data-chart" />
      </div>
    </div>
    <div class="app-center" id="map-container">
      <div
        ref="mapChart"
        class="map-chart"
        id="mapChart"
        v-show="!baiduMapShow"
      ></div>
      <baidu-map
        :center="center"
        :zoom="zoom"
        :scroll-wheel-zoom="true"
        id="baiduMapChart"
        class="map-chart"
        ak="x5q3GuwjwCwkgcofT6TShe0jHWcTmg8c"
        @ready="onCityReady"
        v-show="baiduMapShow"
      >
        <bm-view style="width: 100%; height:100%; flex: 1"></bm-view>
        <div v-show="localSearch">
        <!-- 标记点 -->
        <bm-marker v-for="(item, index) in points" :key="index" :position="item.location">
            <bm-label :content="item.name" :labelStyle="{color: '#333', fontSize : '14px', padding: '0 6px'}" :offset="{width: -35, height: 30}"/>
          </bm-marker>
        <!-- 标记点 -->
        </div>
        <!-- 路线图 -->
        <bm-driving
          start="天安门"
          end="百度大厦"
          @searchcomplete="handleSearchComplete"
          :panel="false"
          v-if="showRouteMap"
          :autoViewport="true"
        ></bm-driving>
        <bml-lushu v-if="showRouteMap" :path="path" :icon="icon" :play="false" :rotation="true">
        </bml-lushu>
        <!-- 路线图 -->
        <!-- 影响范围图 -->
        <div v-if="showHeatMap">
          <bml-heatmap :data="heatMapData" :max="100" :radius="20">
          <!-- <bml-heatmap :data="heatMapData" :max="100" :radius="20" :gradient="{.7:'rgb(102, 205, 170)', .8:'rgb(241,148,138)',.5:'rgba(178, 34, 34)'}"> -->
          </bml-heatmap>
        </div>
        <!-- 影响范围图 -->
        <!-- 地区检索 -->
        <!-- <div v-show="localSearch">
          <bm-local-search
            :keyword="searchKeyword"
            :location="center"
            :panel="false"
            :forceLocal="true"
            :auto-viewport="true"
            @searchcomplete='searchcomplete'
          ></bm-local-search>
        </div> -->
        <!-- 地区检索 -->
      </baidu-map>
    </div>
    <div class="app-right">
      <div class="right-top flex">
        <div class="disaster-history">
          <div ref="disasterChart" class="disaster-chart"></div>
        </div>
        <div class="earthquake-times">
          <div class="header center">
            {{
              baiduMapShow
                ? "医院数量统计"
                : `${currentMonth.year}年${currentMonth.month}月省份地震频率`
            }}
          </div>
          <div class="poll-main" v-if="pollList.length">
            <div
              v-for="(item, index) in pollList"
              :key="index"
              class="poll-item"
            >
              <div class="poll-line1">
                <div class="poll-name" v-show="!baiduMapShow">
                  {{ item.province }}
                </div>
                <div class="poll-name" v-show="baiduMapShow">
                  {{ item.type | typeFilter }}
                </div>
                <div class="poll-date">
                  {{ item.totalCount }}（{{ baiduMapShow ? "个" : "次" }}）
                </div>
              </div>
              <div class="num-box">
                <el-progress
                  :text-inside="true"
                  :stroke-width="10"
                  :percentage="computedPercentage(item.totalCount)"
                  v-if="computedPercentage(item.totalCount)"
                ></el-progress>
              </div>
            </div>
          </div>
          <div class="no-data" v-else>暂无数据</div>
        </div>
      </div>
      <div class="bottom-chart">
        <div ref="influenceChart" class="influence-chart"></div>
      </div>
    </div>
  </div>
</template>

<script>
import BaiduMap from 'vue-baidu-map/components/map/Map.vue'
import BmView from 'vue-baidu-map/components/map/MapView.vue'
import BmMarker from 'vue-baidu-map/components/overlays/Marker.vue'
import BmLabel from 'vue-baidu-map/components/overlays/Label.vue'
import BmLocalSearch from 'vue-baidu-map/components/search/LocalSearch.vue'
import BmDriving from 'vue-baidu-map/components/search/Driving.vue'
import { BmlHeatmap, BmlLushu } from 'vue-baidu-map'
import echarts from '@/utils/echarts'
import { baiDuMapSearch, earthquakeTimes, disasterInfluence, economyInfo, getReportList, peopleLoss, getRefugeInfo, getHospitalCount, getEarthquakeInfos, getEarthquakeSphere } from '@/api/map-chart'
import { convertMapData } from '@/utils/datetime'
export default {
  components: {
    BaiduMap,
    BmView,
    BmMarker,
    BmLabel,
    BmDriving,
    BmlLushu,
    BmlHeatmap,
    BmLocalSearch
  },
  filters: {
    typeFilter(val) {
      let level = {
        0: '三甲医院',
        1: '三乙医院',
        2: '三丙医院',
        3: '二甲医院',
        4: '二乙医院',
        5: '二丙医院',
        6: '一甲医院',
        7: '一乙医院',
        8: '一丙医院',
        9: '未定级',
      }
      return level[val]
    }
  },
  data() {
    return {
      effectData: [],
      mapslist: ['学校分布图', '影响范围图', '避难场所分布图', '医院分布图', '救援物资路线图'],
      activeType: 1,
      disasterPeople: [{
        name: '受伤人数',
        count: 0
      }, {
        name: '失踪人数',
        count: 0
      }, {
        name: '失去住所人数',
        count: 0
      }, {
        name: '需转移安置人数',
        count: 0
      }, {
        name: '已转移安置人数',
        count: 0
      }],
      refugeData: [],
      markerList: [],
      showRouteMap: false,
      showHeatMap: false,
      disasterChart: null,
      timesChart: null,
      hospitalChart: null,
      baiduMapShow: false,
      activeMap: -1,
      pollList: [],
      earthQuakeList: [],
      pollTotalData: 0,
      hospitalList: [],
      renderMapChart: true,
      center: { lng: 116.404, lat: 39.915 },
      zoom: 11,
      heatMapData: [],
      points: [],
      path: [],
      icon: {
        url: 'http://api.map.baidu.com/library/LuShu/1.2/examples/car.png',
        size: { width: 52, height: 26 },
        opts: { anchor: { width: 27, height: 13 } }
      },
      params: {
        province: null,
        city: null,
        country: '中国',
        endDate: '',
        startDate: ''
      },
      currentMonth: {},
      disasterList: {
        level: [],
        area: [],
        people: []
      },
      searchKeyword: '',
      economyData: [],
      localSearch: false,
      BMap: null,

      latestEQData: [],
      mapChart: null,
      influenceChart: null,
      currentLocation: '',
      currentEQTime: '',
      currentAlertTime: '',
      dataAll: {
        latestEQData: [],
        currentEQData: [],
        areaData: {},
        populationData: {},
        levelData: [],
        provinceData: {},
        frequencyData: {},
        economyData: {},
        mapData: []
      },
      chart1: null,
      chart2: null,
      chart3: null,
      reportList: [],
      provincesText: ['上海市', '河北省', '山西省', '内蒙古自治区', '辽宁省', '吉林省', '黑龙江省', '江苏省', '浙江省', '安徽省', '福建省', '江西省', '山东省', '河南省', '湖北省', '湖南省', '广东省', '广西壮族自治区', '海南省', '四川省', '贵州省', '云南省', '西藏自治区', '陕西省', '甘肃省', '青海省', '宁夏回族自治区', '新疆维吾尔自治区', '北京市', '天津市', '重庆市', '香港特别行政区', '澳门特别行政区', '台湾省'],
      map: {},
      recentFiveYear: {},
      province: '', //记录进入的省级地图名称
      allcode: []
    }
  },
  created() {
    const dateMat = new Date()
    const year = dateMat.getFullYear()
    let month = dateMat.getMonth() + 1
    let date = dateMat.getDate()
    month < 10 ? month = `0${month}` : ''
    date < 10 ? date = `0${date}` : ''
    // this.params.startDate = `${year}-${month}-01 00:00:00`

    // let lastday = getLastDay(year, month)
    // this.params.endDate = `${year}-${month}-${lastday} 23:59:59`
    this.recentFiveYear = {
      startDate: `${year - 5}-${month}-${date} 00:00:00`,
      endDate: `${year}-${month}-${date} 00:00:00`
    }
    this.currentMonth = {
      year,
      month
    }
    this.params.startDate = `2015-01-01 00:00:00`
    this.params.endDate = `2015-08-31 23:59:59`
    this.getAllCode()

    this.initData()
  },
  mounted() {
    this.getHomeData()
  },
  methods: {
    initData() {
      this.getEarthquakeTimes()  // 地震频次
      this.getdisasterAreaAndPeople()   // 历年受灾情况
      this.getReportList(1)   // 专报快报
      this.getpeopleLoss()    // 地震人口损失
      this.getRefugeInfo()    // 避难场所
      this.economyInfo()    // 经济影响
      this.getHospitalCount()    // 医院数量
    },
    goReportDetail(id) {
      window.open(`#/report-detail?id=${id}`, '_blank')
    },
    computedPercentage(count) {
      return Number((count / this.pollTotalData * 100).toFixed(2))
    },
    initChart1() {
      if (this.chart1) this.chart1.dispose()
      this.chart1 = echarts.init(this.$refs.dataChart)
      const colorList = ['#0089BA']
      this.chart1.setOption({
        title: {
          text: '各类避难场所数量（最新）',
          textStyle: {
            color: '#fff',
            fontSize: this.fontSize(0.18)
          },
          top: '4%',
          left: '4%'
        },
        tooltip: {
          trigger: 'axis'
        },
        color: colorList,
        grid: {
          left: '6%',
          right: '8%',
          bottom: '6%',
          top: '24%',
          containLabel: true
        },
        xAxis: {
          type: 'category',
          axisLabel: {
            color: '#fff',
            interval: 0,
            fontSize: this.fontSize(0.12)
          },
          splitLine: {
            show: false
          },
          axisTick: {
            show: false
          },
          axisLine: {
            show: false
          },
          data: ['学校', '公园', '体育场', '广场', '绿地', '临时安置点']
        },
        yAxis: {
          type: 'value',
          axisLine: {
            show: false
          },
          splitLine: {
            show: false
          },
          axisLabel: {
            color: '#fff',
            fontSize: this.fontSize(0.14)
          }
        },
        series: [{
          data: this.refugeData,
          barWidth: this.fontSize(0.22),
          label: {
            show: true,
            position: 'top',
            color: '#fff',
            fontSize: this.fontSize(0.12)
          },
          type: 'bar'
        }]
      })
    },
    initChart2() {
      if (this.chart2) this.chart2.dispose()
      this.chart2 = echarts.init(this.$refs.disasterChart)
      const colorList = ['#6A8DFF', '#AE82FF']
      this.chart2.setOption({
        title: {
          text: '近五年受灾情况',
          textStyle: {
            color: '#fff',
            fontSize: this.fontSize(0.18)
          },
          left: '4%',
          top: '4%'
        },
        tooltip: {
          trigger: 'axis'
        },
        grid: {
          left: '16%',
          right: '6%',
          bottom: '16%',
          top: '22%'
        },
        legend: {
          textStyle: {
            color: '#fff',
            fontSize: this.fontSize(0.12)
          },
          itemWidth: this.fontSize(0.22),
          itemHeight: this.fontSize(0.12),
          top: '4%',
          right: '4%',
          orient: 'vertical',
          data: ['受灾面积', '受灾人数']
        },
        color: colorList,
        xAxis: {
          type: 'category',
          axisLabel: {
            color: '#fff',
            fontSize: this.fontSize(0.12),
            interval: 0
          },
          axisTick: {
            show: false
          },
          axisLine: {
            show: false
          },
          splitLine: {
            show: false
          },
          data: this.disasterList.level
        },
        yAxis: {
          type: 'value',
          axisLine: {
            show: false
          },
          splitLine: {
            show: false
          },
          axisLabel: {
            color: '#fff',
            fontSize: this.fontSize(0.12)
          }
        },
        series: [{
          data: this.disasterList.area,
          label: {
            show: true,
            position: 'top',
            color: '#fff',
            fontSize: this.fontSize(0.12)
          },
          barWidth: this.fontSize(0.18),
          type: 'bar',
          name: '受灾面积',
          backgroundStyle: {
            color: 'rgba(220, 220, 220, 0.8)'
          }
        }, {
          data: this.disasterList.people,
          label: {
            show: true,
            position: 'top',
            color: '#fff',
            fontSize: this.fontSize(0.12)
          },
          barWidth: this.fontSize(0.18),
          type: 'bar',
          name: '受灾人数',
          backgroundStyle: {
            color: 'rgba(220, 220, 220, 0.8)'
          }
        }]
      })
    },
    initChart3() {
      if (this.chart3) this.chart3.dispose()
      this.chart3 = echarts.init(this.$refs.influenceChart)
      const colorList = [ '#2EC7CF', '#FFEE96', '#FF9671', '#EB3B5A' ]
      let seriesList = []
      this.economyData.map(item => {
        let series = {
          name: item.name,
          data: item.list,
          label: {
            show: true,
            position: 'top',
            color: '#fff',
            fontSize: this.fontSize(0.12)
          },
          type: 'bar'
        }
        seriesList.push(series)
      })
      let legendList = []
      this.economyData.map(item => {
        legendList.push(item.name)
      })
      this.chart3.setOption({
        title: {
          text: '近五年经济影响',
          textStyle: {
            color: '#fff',
            fontSize: this.fontSize(0.18)
          },
          top: '6%',
          left: '2%'
        },
        tooltip: {
          trigger: 'axis'
        },
        legend: {
          textStyle: {
            color: '#fff',
            fontSize: this.fontSize(0.12)
          },
          itemWidth: this.fontSize(0.22),
          itemHeight: this.fontSize(0.12),
          top: '15%',
          right: '6%',
          data: legendList
        },
        grid: {
          left: '6%',
          right: '6%',
          bottom: '6%',
          top: '28%',
          containLabel: true
        },
        color: colorList,
        xAxis: {
          type: 'category',
          axisLabel: {
            color: '#fff',
            fontSize: this.fontSize(0.12)
          },
          axisTick: {
            show: false
          },
          axisLine: {
            show: false
          },
          splitLine: {
            show: false
          },
          data: ['房屋', '道路', '农作物', '桥梁', '其他']
        },
        yAxis: {
          type: 'value',
          axisLine: {
            show: false
          },
          splitLine: {
            show: false
          },
          axisLabel: {
            color: '#fff',
            fontSize: this.fontSize(0.14)
          }
        },
        series: seriesList
      })
    },
    async getpeopleLoss() {
      let params = { ...this.params }
      params.endDate = null
      params.startDate = null
      let { data } = await peopleLoss(params)
      this.disasterPeople[0].count = data ? data.heartCount : 0
      this.disasterPeople[1].count = data ? data.lossCount : 0
      this.disasterPeople[2].count = data ? data.unhouseCount : 0
      this.disasterPeople[3].count = data ? data.unmigrateCount : 0
      this.disasterPeople[4].count = data ? data.migrateCount : 0
    },
    async getRefugeInfo() {
      let params = { ...this.params }
      params.endDate = null
      params.startDate = null
      this.$set(this, 'refugeData', [])
      let { data } = await getRefugeInfo(params)
      data.map(item => {
        this.refugeData.push(item.totalCount)
      })
      this.initChart1()   // 避难场所
    },
    async economyInfo() {
      let params = {
        country: this.params.country,
        province: this.params.province,
        city: this.params.city,
        startDate: this.recentFiveYear.startDate,
        endDate: this.recentFiveYear.endDate,
      }
      this.$set(this, 'economyData', [])
      let { data } = await economyInfo(params)
      data.map(item => {
        let list = []
        item.earthquakeInfo.map(each => {
          list.push(each.totalEconomy)
        })
        this.economyData.push({ name: item.level, list })
      })
      this.initChart3()   // 经济影响
    },
    async getReportList(type) {
      let { data } = await getReportList({ pageNum: 1, pageSize: 10, type, status: 1 })
      this.reportList = data.rows
      this.activeType = type
    },
    async getEarthquakeTimes() {
      let { data } = await earthquakeTimes(this.params)
      this.earthQuakeList = data  // 存储起来方便显示隐藏地图时直接切换数据
      this.pollList = this.earthQuakeList
      this.getPollTotalData()
    },
    async getHospitalCount() {
      let { data } = await getHospitalCount(this.params)
      this.hospitalList = data  // 存储起来方便显示隐藏地图时直接切换数据
    },
    async getAllCode() {
      this.$http({
        url: 'mapData/allcode.json',
        method: 'get',
        headers: { 'content-Type': 'x-www-form-urlencoded' }
      }).then(res => {
        this.allcode = res.data
      })
    },
    getPollTotalData() {
      let list = []
      if (this.pollList.length) {
        this.pollList.map(item => {
          list.push(item.totalCount)
        })
        this.pollTotalData = list.reduce((prev, curr) => prev + curr)
      } else {
        this.pollList = []
        this.pollTotalData = 0
      }
    },
    async getdisasterAreaAndPeople() {
      this.$set(this.disasterList, 'level', [])
      this.$set(this.disasterList, 'area', [])
      this.$set(this.disasterList, 'people', [])
      let { data } = await disasterInfluence(this.params)
      data.map(item => {
        this.disasterList.level.push(item.level)
        this.disasterList.area.push(item.earthquakeInfo.totalArea)
        this.disasterList.people.push(item.earthquakeInfo.totalPeople)
      })
      this.initChart2()
    },
    async mapShow(index) {
      this.activeMap = index
      this.baiduMapShow = true
      this.onCityReady()
      this.pollList = this.hospitalList
      this.getPollTotalData()
    },
    showMapPoints() {
      switch (this.activeMap) {
        case 0:
          this.getPoints('学校', '学校,大学,学院')
          this.showHeatMap = false
          this.showRouteMap = false
          break;
        case 1:
          this.center = {
            lng: this.heatMapData[0].lng,
            lat: this.heatMapData[0].lat
          }  
          this.showHeatMap = true
          this.showRouteMap = false
          this.localSearch = false
          break;
        case 2:
          this.getPoints('公园', '避难场所, 广场, 体育场')
          this.showHeatMap = false
          this.showRouteMap = false
          break;
        case 3:
          this.getPoints('医院', '医院,急救中心')
          this.showHeatMap = false
          this.showRouteMap = false
          break;
        case 4:
          this.markerList = []
          this.showHeatMap = false
          this.showRouteMap = true
          this.localSearch = false
          break;
      }
    },
    async getPoints(keyWords, searchType, city = '') {
      let region = '北京'
      if (this.params.province) {
        region = this.params.province + (this.params.city || city)
      }
      let params = {
        query: keyWords,
        tag: searchType,
        region,
        page_size: 20,
        output: "json",
        ak: "x5q3GuwjwCwkgcofT6TShe0jHWcTmg8c"
      }
      let data = await baiDuMapSearch(params)
      if(this.params.city || city) {
        this.points = data.results
      } else {
        this.getPoints(keyWords, searchType, data.results[0].name)
      } 
    },
    onCityReady(e) {
      if (!this.BMap) this.BMap = e.BMap
      if (!this.baiduMapShow) return
      const myGeo = new this.BMap.Geocoder()
      let place = '北京'
      if (this.params.province) {
        place = this.params.province + (this.params.city || '')
      }
      myGeo.getPoint(place, (point) => {
        if (point) {      
          this.center = {
            lng: point.lng,
            lat: point.lat
          }  
          this.showMapPoints()      
        }
      }, place)
    },
    mapHide() {
      this.activeMap = -1
      this.baiduMapShow = false
      this.pollList = this.earthQuakeList
      this.getPollTotalData()
    },
    handleSearchComplete(res) {
      this.path = res.getPlan(0).getRoute(0).getPath()
    },
    searchcomplete(res) {
      console.log(res, 'complete')
    },
    fontSize(res){
      let docEl = document.documentElement,
        clientWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth
      if (!clientWidth) return
      let fontSize = 100 * (clientWidth / 1920)
      return res*fontSize
    },
    getHomeData(type) {
      getEarthquakeInfos(this.params).then(response => {
        // type = 1 表示是进入省市地图层，不要重新渲染，只是为了获取省市图层的地震数据，作为影响范围图渲染的数据
        if (type) {
          this.effectData = response.data
          this.getEffectData(1)
        } else {
          this.dataAll = response.data
          this.showChinaMap()
          this.getEffectData()
        }
      })
    },
    async getEffectData(type) {
      // 有type表示进入省市图层,没有的话默认获取北京的地震影响范围信息
      if (!type) {
        let params = { 
          province: '北京市'
        }
        let { data } = await getEarthquakeInfos(params)
        this.effectData = data
      }
      this.heatMapData = []
      let list = []
      this.effectData.map(async item => {
        let params = {
          depth: item.depth,
          id: item.id,
          latitude: item.latitude,
          level: item.level,
          longitude: item.longitude,
          province: type ? this.params.province : '北京市'
        }
        let { data } = await getEarthquakeSphere(params)
        data.map(item => {
          list.push(item)
        })
        this.$set(this, 'heatMapData', list)
      })
    },
    //地图参数配置                 
    getMapOpt(place) {
      let option = { // 进行相关配置               
        tooltip: {
          trigger: 'item',
          formatter: function (params) {
            let data = params.data
            let toolTiphtml = ''
            toolTiphtml += `
              <div style="text-align:left;">
                <span>参考位置：</span><span>${data.location}</span>
              </div>
              <div style="text-align:left;">
                <span>发震时刻：</span><span>${data.time}</span>
              </div>
              <div style="text-align:left;">
                <span>经度：</span><span>${data.longitude}</span>
              </div>
              <div style="text-align:left;">
                <span>纬度：</span><span>${data.latitude}</span>
              </div>
              <div style="text-align:left;">
                <span>深度：</span><span>${data.depth}</span><span>km</span>
              </div>
              <div style="text-align:left;">
                <span>震级：</span><span>${data.level}</span>
              </div>`
            return toolTiphtml
          }
        },
        visualMap: {
          show: true,
          type: 'piecewise',
          precision: 1,
          itemWidth: 12,
          itemHeight: 12,
          bottom: 0,
          left: 0,
          pieces: [
            {
              min: 3.0,
              max: 3.9
            },
            {
              min: 4.0,
              max: 4.9
            },
            {
              min: 5.0,
              max: 5.9
            },
            {
              min: 6.0
            }
          ],
          showLabel: true,
          text: ['震级'],
          textStyle: {
            color: '#fff'
          },
          calculable: true,
          inRange: {
            color: [ '#2EC7CF', '#FFEE96', '#FF9671', '#EB3B5A' ]
          }
        },
        backgroundColor: '#060d1f',
        geo: { // 这个是重点配置区
          map: place ? place : 'china', // 表示中国地图
          roam: false,
          label: {
            normal: {
              show: true, // 是否显示对应地名
              textStyle: {
                color: '#fff',
                fontSize: this.fontSize(0.12)
              }
            }
          },
          itemStyle: {
            normal: {
              areaColor: '#2F7597',
              borderColor: '#0D1F31'
            },
            emphasis: {
              areaColor: '#085d82'
            }
          }
        },
        series: [
          {
            name: '城市',
            type: 'scatter',
            coordinateSystem: 'geo',
            data: convertMapData(this.dataAll),
            symbolSize: function (val) {
              return val[2] * 2
            },
            roam: false,
            label: {
              normal: {
                formatter: '{b}',
                position: 'right',
                show: false
              },
              emphasis: {
                show: true
              },
            },
            itemStyle: {
              normal: {
                color: '#ffc107'
              }
            }
          },
          // {
          //   name: '当前地震',
          //   type: 'effectScatter',
          //   coordinateSystem: 'geo',
          //   roam: false,
          //   data: convertMapData(this.dataAll.currentEQData),
          //   symbolSize: function (val) {
          //     return val[2] * 3
          //   },
          //   showEffectOn: 'render',
          //   rippleEffect: {
          //     brushType: 'stroke'
          //   },
          //   hoverAnimation: true,
          //   label: {
          //     normal: {
          //       formatter: '{b}',
          //       position: 'right',
          //       show: true
          //     }
          //   },
          //   itemStyle: {
          //     normal: {
          //       color: '#FF5959',
          //       shadowBlur: 200,
          //       shadowColor: 'rgba(255,89,89,0.3)'
          //     }
          //   },
          //   zlevel: 1
          // }
        ]
      }
      return option
    },
    //全国地图
    showChinaMap() {
      this.$http({
        url: 'mapData/100000_full.json',
        method: 'get',
        headers: { 'content-Type': 'x-www-form-urlencoded' }
      }).then(res => {
        echarts.registerMap('china', res.data)
        this.initMap()
      })
    },
    //显示省、市地图
    getAreaMap(cliclRegionCode, name, provinceIndex) {
      this.$http({
        url: (provinceIndex != -1 ? 'province/' : 'city/') + cliclRegionCode + '_full.json',
        method: 'get',
        headers: { 'content-Type': 'x-www-form-urlencoded' }
      }).then(res => {
        this.map.dispose()
        echarts.registerMap(name, res.data)  //注册省、市地图
        this.initMap(name)
      }).catch(() => {
      })
    },
    initMap(place) {
      this.map = echarts.init(this.$refs.mapChart)
      window.onresize = this.map.resize
      let option = this.getMapOpt(place)
      if (option && typeof option === "object") {
        this.map.setOption(option, true)
        setTimeout(() => {
          this.map.hideLoading()
        }, 500)
      }
      this.map.getZr().on('click', (param) => {
        if (!param.target) {
          this.map.off("click")
          this.params.city = null
          this.params.province = null
          this.map.dispose()
          this.showChinaMap()
          this.initData()
        }
      })
      this.map.off("click")// 避免点击触发多次
      this.map.on('click', (param) => {
        let provinceIndex = this.provincesText.findIndex(item => item === param.name)
        let clickRegionCode = this.allcode.filter(item => item.name === param.name)[0].adcode
        if (provinceIndex === -1) {
          if (this.params.city) return   // 当前有city 表示已进入市级地图，直接return
          // 没找到省份名,代表进入到了市图层
          this.params.city = param.name
        } else {
          this.params.province = param.name
        }
        this.initData()
        // 重新渲染地图
        this.getHomeData(1)
        this.getAreaMap(clickRegionCode, param.name, provinceIndex)
      })
    }
  }
}
</script>

<style scoped lang="scss">
$w: 100vw /1920;
.no-data {
  line-height: 50*$w;
  font-size: 14*$w;
  text-align: center;
  color: #90919b;
}
/deep/ .el-progress-bar__outer {
  // height: 10*$w !important;
  .el-progress-bar__innerText {
    font-size: 10 * $w;
    vertical-align: top;
  }
}
#baiduMapChart {
  height: 810 * $w;
}
.map-container {
  position: relative;
  .back-home {
    position: absolute;
    top: -73px;
    left: 3px;
    color: #333;
    cursor: pointer;
    background: #fff;
    border-radius: 4px;
    padding: 8px 12px;
    font-size: 14px;
  }
  .app-left {
    padding-left: 20 * $w;
    .reports-container {
      background: rgb(255, 255, 255);
      border-radius: 8 * $w;
      height: 310 * $w;
      width: 70%;
      .reports-header {
        height: 40 * $w;
        line-height: 40 * $w;
        background: #fff;
        border-radius: 8 * $w 8 * $w 0 0;
        border-bottom: 1px solid #efefef;
        .report-type {
          padding: 0 12 * $w;
          cursor: pointer;
          font-size: 16 * $w;
          &.active {
            color: #409eff;
          }
        }
      }
      .reports-list {
        height: 260 * $w;
        background: #fff;
        overflow: auto;
        padding-top: 8 * $w;
        &::-webkit-scrollbar {
          width: 10 * $w;
          background: #f6f7f7;
          margin-left: 2 * $w;
          border-radius: 0 * $w 8 * $w 8 * $w 0 * $w;
        }
        &::-webkit-scrollbar-thumb {
          width: 10 * $w;
          background: #c3c3c3;
          border-radius: 5 * $w;
        }
        &::-webkit-scrollbar-button {
          display: none;
        }
        .report-item {
          cursor: pointer;
          line-height: 22 * $w;
          padding: 4 * $w 12 * $w;
          font-size: 13 * $w;
          text-align: left;
          justify-content: space-between;
          &:hover {
            background: #f5f5f5;
          }
          .report-left {
            width: 60%;
          }
          .report-right {
            flex: 1;
            padding-left: 10*$w;
            font-size: 13*$w;
            color: #666;
          }
        }
      }
    }
    .maps-page {
      margin-left: 16 * $w;
      width: 55%;
      .maps-header {
        height: 40 * $w;
        line-height: 40 * $w;
        color: #fff;
        padding: 0 10 * $w;
        font-size: 16 * $w;
        background: linear-gradient(90deg, #004e92, #000428);
        .more {
          color: #02c1d7;
          cursor: pointer;
        }
      }
      .maps-list {
        flex-wrap: wrap;
        .maps-item {
          margin-top: 16 * $w;
          flex-shrink: 0;
          width: 100%;
          height: 30 * $w;
          line-height: 30 * $w;
          color: #fff;
          cursor: pointer;
          font-size: 14 * $w;
          text-align: center;
          background: linear-gradient(90deg, #3fada8, #808080);
          &.active {
            background: linear-gradient(90deg, #f05f57, #360940);
          }
        }
      }
    }
    .disaster-container {
      margin: 20 * $w auto;
      color: #fff;
      border: 1px solid #00d2ff;
      border-radius: 8 * $w;
      padding: 10 * $w 0 16 * $w;
      .header {
        line-height: 40 * $w;
        margin-bottom: 10 * $w;
        font-size: 16 * $w;
        font-weight: bold;
      }
      .people-disaster {
        .people {
          flex: 1;
          text-align: center;
          .count {
            margin-bottom: 10 * $w;
            font-size: 18 * $w;
            font-weight: bold;
          }
          .name {
            font-size: 12 * $w;
          }
        }
      }
    }
    .charts-num {
      border: 1px solid #00d2ff;
      border-radius: 8 * $w;
      // padding: 16*$w;
      // background: #fff;
      height: 350 * $w;
      .data-chart {
        width: 100%;
        height: 100%;
      }
    }
  }
  .app-center {
    padding: 0 30 * $w;
    position: relative;
    .map-chart {
      height: 100%;
      & > div {
        height: 100% !important;
      }
    }
  }
  .app-right {
    padding-right: 20 * $w;
    .disaster-history {
      width: 55%;
      height: 300 * $w;
      border-radius: 8 * $w;
      border: 1px solid #00d2ff;
      .disaster-chart {
        height: 100%;
      }
    }
    .earthquake-times {
      flex: 1;
      margin-left: 16 * $w;
      .header {
        color: #fff;
        line-height: 22*$w;
        font-size: 14 * $w;
        font-weight: bold;
        text-align: left;
        font-size: 18 * $w;
      }
      .poll-main {
        padding: 10 * $w 0 10 * $w;
      }
      .poll-item {
        &:not(:nth-child(1)) {
          padding-top: 10 * $w;
        }
        .poll-line1 {
          display: flex;
          justify-content: space-between;
          .poll-name,
          .poll-date {
            font-size: 12 * $w;
            color: #fff;
          }
          .total {
            font-weight: 300;
            color: #999999;
            margin-right: 10 * $w;
          }
        }
        /deep/ .el-progress-bar__inner {
          background-color: unset;
          background-image: linear-gradient(90deg, #6a8dff, #80a4ff);
        }
        /deep/ .el-progress-bar__outer {
          background-color: #19426a !important;
        }
      }
    }
    .hospital-container {
      flex: 1;
      border-radius: 8 * $w;
      border: 1px solid #00d2ff;
      margin-left: 16 * $w;
      height: 300 * $w;
      .hospital-chart {
        height: 100%;
      }
    }
    .bottom-chart {
      height: 380 * $w;
      border: 1px solid #00d2ff;
      border-radius: 8 * $w;
      margin-top: 20 * $w;
      .influence-chart {
        height: 100%;
      }
    }
  }
}
.BoxWrap {
  position: relative;
  background-color: #0b1528;
  border-radius: 4px;
}
.horn {
  position: absolute;
  width: 100%;
  height: 100%;
  border: 0px solid #1cafcc;
}
.horn > div {
  width: 14px;
  height: 14px;
  position: absolute;
  border-radius: 2px;
}
.horn .lt {
  border-top: 2px solid #1cafcc;
  border-left: 2px solid #1cafcc;
  left: 0px;
  top: 0px;
  opacity: 0.3;
}
.horn .rt {
  border-top: 2px solid #1cafcc;
  border-right: 2px solid #1cafcc;
  right: 0px;
  top: 0px;
  opacity: 0.3;
}
.horn .rb {
  border-bottom: 2px solid #1cafcc;
  border-right: 2px solid #1cafcc;
  right: 0px;
  bottom: 0px;
  opacity: 0.3;
}
.horn .lb {
  border-bottom: 2px solid #1cafcc;
  border-left: 2px solid #1cafcc;
  left: 0px;
  bottom: 0px;
  opacity: 0.3;
}
.atagClass {
  font-size: 16px;
  font-family: SourceHanFont, Arial, "Microsoft YaHei", Helvetica, sans-serif,
    "SimSun";
  font-weight: 400;
  color: rgba(1, 238, 247, 1);
  position: relative;
  cursor: pointer;
}
.ptagClass {
  font-size: 14px;
  font-family: SourceHanFont, Arial, "Microsoft YaHei", Helvetica, sans-serif,
    "SimSun";
  font-weight: 400;
  color: rgba(255, 255, 255, 1);
}
.alertTimeClass {
  font-size: 50px;
  font-family: SourceHanFont, Arial, "Microsoft YaHei", Helvetica, sans-serif,
    "SimSun";
  font-weight: bold;
  color: rgba(255, 89, 89, 1);
}
.alertUnitClass {
  font-size: 26px;
  font-family: SourceHanFont, Arial, "Microsoft YaHei", Helvetica, sans-serif,
    "SimSun";
  font-weight: bold;
  color: rgba(255, 89, 89, 1);
}
.pbtnClass {
  width: 100px;
  height: 40px;
  background: rgba(29, 84, 240, 1);
  border-radius: 4px;
  // margin: auto;
  position: absolute;
  cursor: pointer;
  left: 65px;
}
.pbtnTextClass {
  font-size: 14px;
  font-family: SourceHanFont, Arial, "Microsoft YaHei", Helvetica, sans-serif,
    "SimSun";
  font-weight: 400;
  color: rgba(255, 255, 255, 1);
  line-height: 40px;
}
.subTitle {
  color: #cdddf7;
  font-size: 18px;
  padding: 5px 20px;
  border-bottom: 1px solid #025bd6;
  text-align: left;
}
.divtop {
  height: 50px;
  background: rgba(10, 38, 60, 1);
  border-radius: 4px;
}
.divTopText {
  font-size: 16px;
  font-family: SourceHanFont, Arial, "Microsoft YaHei", Helvetica, sans-serif,
    "SimSun";
  font-weight: bold;
  color: #fff;
  line-height: 50px;
}
.divTopText1 {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  text-align: left;
  display: inline-block;
  text-align: center;
}
.divTopText2 {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  text-align: left;
  display: inline-block;
  height: 32px;
  line-height: 38px;
  font-size: 14px;
  font-family: SourceHanFont, Arial, "Microsoft YaHei", Helvetica, sans-serif,
    "SimSun";
  text-align: center;
}
.mainTitle {
  font-size: 30px;
  font-family: SourceHanFont, Arial, "Microsoft YaHei", Helvetica, sans-serif,
    "SimSun";
  font-weight: 500;
  color: rgba(255, 255, 255, 1);
  line-height: 27px;
}
.chartClass {
  height: 280px;
}
.mapClass {
  height: 765px;
}
.centerText {
  color: #cdddf7;
  font-size: 22px;
  padding: 15px 20px;
  text-align: center;
}
</style>
```